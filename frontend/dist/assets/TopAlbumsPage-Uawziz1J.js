import{r as m,j as s,c as T,a as Y,u as C,b as G,L as O}from"./index-CQQhSzCd.js";import{u as N,a as q,s as k,b as R,c as K,S as z,Y as S,g as P,d as U}from"./useTracksFromAlbums-VELjUysz.js";function v({label:e,options:a,selected:t,onChange:o,disabled:r}){const[c,l]=m.useState(!1),[g,n]=m.useState(""),x=m.useRef(null);m.useEffect(()=>{function i(d){x.current&&!x.current.contains(d.target)&&l(!1)}return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const p=a.filter(i=>i.toLowerCase().includes(g.toLowerCase()));function b(i){t.includes(i)?o(t.filter(d=>d!==i)):o([...t,i])}return s.jsxs("div",{ref:x,className:"relative",children:[s.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-300",children:e}),s.jsx("button",{type:"button",disabled:r,onClick:()=>l(!c),className:"w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-left text-base text-gray-200 hover:border-gray-500 disabled:opacity-50 sm:text-sm",children:t.length===0?s.jsx("span",{className:"text-gray-500",children:"All"}):s.jsx("span",{children:t.join(", ")})}),c&&s.jsxs("div",{className:"absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border border-gray-700 bg-gray-800 shadow-xl",children:[s.jsx("div",{className:"sticky top-0 bg-gray-800 p-2",children:s.jsx("input",{type:"text",placeholder:"Search...",value:g,onChange:i=>n(i.target.value),className:"w-full rounded border border-gray-600 bg-gray-900 px-2 py-1 text-base text-gray-200 outline-none focus:border-indigo-500 sm:text-sm"})}),t.length>0&&s.jsx("button",{type:"button",onClick:()=>o([]),className:"w-full px-3 py-1.5 text-left text-xs text-indigo-400 hover:bg-gray-700",children:"Clear all"}),p.map(i=>s.jsxs("label",{className:"flex cursor-pointer items-center gap-2 px-3 py-2 text-base hover:bg-gray-700 sm:py-1.5 sm:text-sm",children:[s.jsx("input",{type:"checkbox",checked:t.includes(i),onChange:()=>b(i),className:"rounded border-gray-600 bg-gray-900 text-indigo-500 focus:ring-indigo-500"}),s.jsx("span",{className:"text-gray-200",children:i})]},i)),p.length===0&&s.jsx("p",{className:"px-3 py-2 text-sm text-gray-500",children:"No results"})]})]})}const B={Frenetic:"bg-red-600",Weird:"bg-red-500",Gritty:"bg-gray-500",Cathartic:"bg-blue-600",Wistful:"bg-blue-400",Sultry:"bg-violet-600",Intimate:"bg-violet-400",Groovy:"bg-green-600",Upbeat:"bg-green-400",Visceral:"bg-yellow-500",Lush:"bg-orange-500",Sprawling:"bg-orange-400",Ethereal:"bg-orange-300"};function W(e){return B[e]??"bg-gray-600"}function D({mood:e}){return s.jsx("span",{className:`${W(e)} inline-block rounded-full px-2.5 py-0.5 text-xs font-medium text-white`,children:e})}function I({accolades:e}){return!e||e.length===0?s.jsx("p",{className:"text-sm text-gray-500",children:"No accolades found"}):s.jsx("ul",{className:"space-y-1 text-sm text-gray-300",children:e.map((a,t)=>s.jsxs("li",{children:[a.publication," (",a.list,"): ",a.rank]},t))})}function Q({position:e,artist:a,album:t,genre:o,subgenre:r,year:c,imageUrl:l,moods:g,appleMusicUrl:n,accolades:x,showSubgenres:p}){const[b,i]=m.useState(!1),[d,w]=m.useState(!1);return s.jsxs("div",{className:"flex gap-3 rounded-xl bg-gray-900 p-3 sm:gap-4 sm:p-4",children:[s.jsx("img",{src:l,alt:`${a} - ${t}`,className:"h-28 w-28 flex-shrink-0 rounded-lg object-cover sm:h-40 sm:w-40 md:h-48 md:w-48",loading:"lazy"}),s.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center gap-1",children:[e!==void 0&&s.jsxs("span",{className:"text-lg font-bold text-indigo-400",children:["#",e+1]}),s.jsx("h3",{className:"truncate text-lg font-semibold text-white",children:a}),s.jsx("h4",{className:"truncate text-base text-gray-200",children:t}),s.jsx("p",{className:"text-sm text-gray-400",children:p&&r?r:o}),s.jsx("p",{className:"text-sm text-gray-500",children:c}),g&&g.length>0&&s.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:[...g].sort().map(f=>s.jsx(D,{mood:f},f))}),s.jsx("button",{type:"button",onClick:()=>i(!b),className:"mt-2 py-1 text-left text-xs font-medium text-gray-400 hover:text-gray-200",children:b?"- Accolades":"+ Accolades"}),b&&s.jsx("div",{className:"mt-1",children:s.jsx(I,{accolades:x})}),s.jsx("button",{type:"button",onClick:()=>w(!d),className:"py-1 text-left text-xs font-medium text-gray-400 hover:text-gray-200",children:d?"- Listen":"+ Listen"}),d&&s.jsx("div",{className:"mt-1",children:n?s.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"inline-block rounded-lg bg-pink-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-pink-500",children:"Listen on Apple Music"}):s.jsx("p",{className:"text-sm text-gray-500",children:"Not available on Apple Music"})})]})]})}function V({albums:e,accolades:a,columns:t=1,showPositions:o=!0,showSubgenres:r=!1,startIndex:c=0,endIndex:l}){const g=e.slice(c,l??e.length);return s.jsx("div",{className:t===2?"grid grid-cols-1 gap-4 lg:grid-cols-2":"flex flex-col gap-4",children:g.map((n,x)=>s.jsx(Q,{position:o?c+x:void 0,artist:n.artist,album:n.album,genre:n.genre,subgenre:n.subgenre,year:n.year,imageUrl:n.image_url,moods:n.moods,appleMusicUrl:n.apple_music_album_url??n.album_url,accolades:a==null?void 0:a[n.album_key],showSubgenres:r},n.album_key+x))})}const H=new Date().getFullYear(),J=T((e,a)=>({yearMode:"single",singleYear:2025,minYear:2e3,maxYear:H,genres:[],subgenres:[],publications:[],lists:[],moods:[],albumLimit:100,setYearMode:t=>e({yearMode:t}),setSingleYear:t=>e({singleYear:t}),setMinYear:t=>e({minYear:t}),setMaxYear:t=>e({maxYear:t}),setGenres:t=>e({genres:t,subgenres:[],lists:[]}),setSubgenres:t=>e({subgenres:t,lists:[]}),setPublications:t=>e({publications:t,lists:[]}),setLists:t=>e({lists:t}),setMoods:t=>e({moods:t}),setAlbumLimit:t=>e({albumLimit:t}),effectiveMinYear:()=>{const t=a();return t.yearMode==="single"?t.singleYear:t.minYear},effectiveMaxYear:()=>{const t=a();return t.yearMode==="single"?t.singleYear:t.maxYear}}));function X(){return N({queryKey:["publications"],queryFn:async()=>{const{data:e}=await Y.get("/web/publications/");return e.publications}})}function Z(){return N({queryKey:["moods"],queryFn:async()=>{const{data:e}=await Y.get("/web/moods/");return e.moods.sort()}})}function ee(e){const{minYear:a,maxYear:t,genre:o,subgenre:r,publication:c}=e;return N({queryKey:["relevantLists",a,t,o,r,c],queryFn:async()=>{const l=new URLSearchParams;l.set("min_year",String(a)),l.set("max_year",String(t)),l.set("ignore_monthly_lists",String(a!==t)),o!=null&&o.length?o.forEach(n=>l.append("genre",n)):l.append("genre",""),r!=null&&r.length?r.forEach(n=>l.append("subgenre",n)):l.append("subgenre",""),c!=null&&c.length?c.forEach(n=>l.append("publication",n)):l.append("publication","");const{data:g}=await Y.get(`/web/get_relevant_lists/?${l.toString()}`);return g.lists}})}function se(e){return N({queryKey:["albumAccolades",e],queryFn:async()=>{const a=new URLSearchParams;e.slice(0,50).forEach(o=>a.append("album_ids",o));const{data:t}=await Y.get(`/web/get_album_accolades_multiple_albums/?${a.toString()}`);return t.albums},enabled:e.length>0})}function ne(){const e=J(),a=C(u=>u.isAuthorized),t=C(u=>u.createPlaylist),o=G(u=>u.playTracks),{data:r}=q(),{data:c}=X(),{data:l}=Z(),g=m.useMemo(()=>r?k(Object.keys(r)):[],[r]),n=m.useMemo(()=>{if(!r||e.genres.length===0)return[];const u=[];return e.genres.forEach(h=>{r[h]&&u.push(...r[h])}),k(u)},[r,e.genres]),x=m.useMemo(()=>c?k(Object.keys(c)):[],[c]),p=e.effectiveMinYear(),b=e.effectiveMaxYear(),{data:i}=ee({minYear:p,maxYear:b,genre:e.genres,subgenre:e.subgenres,publication:e.publications}),{data:d,isLoading:w}=R({minYear:p,maxYear:b,genre:e.genres,subgenre:e.subgenres,publication:e.publications,list:e.lists,mood:e.moods}),f=m.useMemo(()=>d?d.map(u=>u.album_key):[],[d]),{data:A}=se(f),{data:y}=K(f,e.albumLimit,a);async function _(){if(!y||y.length===0)return;const u=e.yearMode==="single"?String(e.singleYear):`${e.minYear} - ${e.maxYear}`,h=P(e.genres,e.subgenres);let j=`Top Albums ${u}`;h&&(j+=` ${h}`),await o(y,j)}async function E(){if(!y||y.length===0)return;const u=y.map($=>$.track_id),h=e.yearMode==="single"?String(e.singleYear):`${e.minYear} - ${e.maxYear}`,j=P(e.genres,e.subgenres),L=U(e.publications);let M=h;j&&(M+=` ${j}`),L&&(M+=` ${L}`);const F=await t(M,u);alert(F?"Playlist created! Check your Apple Music library.":"Failed to create playlist. Please try again.")}return s.jsxs("div",{className:"flex h-full flex-col overflow-y-auto",children:[s.jsxs(z,{label:"Filters",children:[s.jsxs("div",{children:[s.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-300",children:"Year Selection"}),s.jsxs("select",{value:e.yearMode,onChange:u=>e.setYearMode(u.target.value),className:"w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-base text-gray-200 sm:text-sm",children:[s.jsx("option",{value:"single",children:"One Year"}),s.jsx("option",{value:"range",children:"Multiple Years"})]})]}),s.jsx("div",{children:e.yearMode==="single"?s.jsx(S,{label:"Year",value:e.singleYear,onChange:e.setSingleYear,reverse:!0}):s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx(S,{label:"First Year",value:e.minYear,onChange:e.setMinYear}),s.jsx(S,{label:"Last Year",value:e.maxYear,onChange:e.setMaxYear,reverse:!0})]})}),s.jsx("div",{children:s.jsx(v,{label:"Genres",options:g,selected:e.genres,onChange:e.setGenres})}),e.genres.length>0&&s.jsx("div",{children:s.jsx(v,{label:"Subgenres",options:n,selected:e.subgenres,onChange:e.setSubgenres})}),s.jsx("div",{children:s.jsx(v,{label:"Publications",options:x,selected:e.publications,onChange:e.setPublications})}),s.jsx("div",{children:s.jsx(v,{label:"Lists",options:i??[],selected:e.lists,onChange:e.setLists})}),s.jsx("div",{children:s.jsx(v,{label:"Moods",options:l??[],selected:e.moods,onChange:e.setMoods})}),a&&s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("button",{type:"button",onClick:_,className:"w-full rounded-lg bg-indigo-600 px-3 py-2 text-sm font-medium text-white hover:bg-indigo-500",children:"Play in Browser"}),s.jsx("button",{type:"button",onClick:E,className:"w-full rounded-lg bg-pink-600 px-3 py-2 text-sm font-medium text-white hover:bg-pink-500",children:"Export to Apple Music"})]})]}),s.jsx("div",{className:"flex-1 p-4 sm:p-6",children:w?s.jsx(O,{}):d&&d.length>0?s.jsx(V,{albums:d,accolades:A,showPositions:!0,showSubgenres:e.subgenres.length>0,endIndex:50}):s.jsx("p",{className:"py-10 text-center text-gray-500",children:"No albums found for the selected filters."})})]})}export{ne as default};
