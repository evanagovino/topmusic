import{r as i,u as C,b as f,j as t,c as z,a as A,L as F}from"./index-CQQhSzCd.js";import{u as L,a as R,s as G,b as $,c as E,S as q,Y as _}from"./useTracksFromAlbums-VELjUysz.js";function O({track:e,position:n,allTracks:s,trackIndex:c}){const[l,u]=i.useState(!1),g=C(o=>o.isAuthorized),x=f(o=>o.playTrackAtIndex),p=f(o=>o.currentTrack),a=f(o=>o.isPlaying),h=f(o=>o.lovedTrackIds),y=f(o=>o.toggleLove),v=(p==null?void 0:p.track_id)===e.track_id,b=h.has(e.track_id),j=g&&s&&c!==void 0;function N(){j&&x(s,c)}return t.jsxs("div",{className:`flex gap-3 rounded-xl p-3 sm:gap-4 sm:p-4 ${v?"bg-gray-800 ring-1 ring-indigo-500":"bg-gray-900"}`,children:[e.image_url&&t.jsxs("div",{className:"relative flex-shrink-0",children:[t.jsx("img",{src:e.image_url,alt:`${e.artist} - ${e.album_name}`,className:"h-28 w-28 rounded-lg object-cover sm:h-40 sm:w-40 md:h-48 md:w-48",loading:"lazy"}),j&&t.jsx("button",{type:"button",onClick:N,className:"absolute inset-0 flex items-center justify-center rounded-lg bg-black/40 opacity-0 transition-opacity hover:opacity-100","aria-label":`Play ${e.track_name}`,children:v&&a?t.jsx("svg",{className:"h-12 w-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}):t.jsx("svg",{className:"h-12 w-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M8 5v14l11-7z"})})})]}),t.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center gap-1",children:[n!==void 0&&t.jsxs("span",{className:"text-lg font-bold text-indigo-400",children:["#",n+1]}),t.jsx("h3",{className:"truncate text-lg font-semibold text-white",children:e.track_name}),t.jsx("h4",{className:"truncate text-base text-gray-200",children:e.artist}),t.jsx("p",{className:"truncate text-sm text-gray-300",children:e.album_name}),t.jsx("p",{className:"text-sm text-gray-400",children:e.subgenre??e.genre}),e.year&&t.jsx("p",{className:"text-sm text-gray-500",children:e.year}),g&&t.jsxs("button",{type:"button",onClick:()=>y(e.track_id),className:"mt-1 flex items-center gap-1.5 py-1 text-left text-xs font-medium text-gray-400 hover:text-gray-200","aria-label":b?"Remove from favorites":"Add to favorites",children:[t.jsx("svg",{className:`h-4 w-4 ${b?"text-pink-500":"text-gray-400"}`,fill:b?"currentColor":"none",stroke:"currentColor",strokeWidth:b?0:2,viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"})}),b?"Loved":"Love"]}),t.jsx("button",{type:"button",onClick:()=>u(!l),className:"mt-2 py-1 text-left text-xs font-medium text-gray-400 hover:text-gray-200",children:l?"- Listen":"+ Listen"}),l&&t.jsx("div",{className:"mt-1",children:e.album_url?t.jsx("a",{href:e.album_url,target:"_blank",rel:"noopener noreferrer",className:"inline-block rounded-lg bg-pink-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-pink-500",children:"Listen on Apple Music"}):t.jsx("p",{className:"text-sm text-gray-500",children:"Not available on Apple Music"})})]})]})}const B=new Date().getFullYear(),K=z((e,n)=>({mode:"genre",genre:null,subgenre:null,minYear:2e3,maxYear:B,artistName:null,artistId:null,customPrompt:"",submittedPrompt:null,playlistName:null,explanation:null,albumLimit:100,generatedTracks:null,isGenerating:!1,setMode:s=>e({mode:s,generatedTracks:null}),setGenre:s=>e({genre:s,subgenre:null,isGenerating:!1}),setSubgenre:s=>e({subgenre:s,isGenerating:!1}),setMinYear:s=>e({minYear:s,isGenerating:!1}),setMaxYear:s=>e({maxYear:s,isGenerating:!1}),setArtistName:s=>e({artistName:s}),setArtistId:s=>e({artistId:s}),setCustomPrompt:s=>e({customPrompt:s}),submitPrompt:()=>e(s=>({submittedPrompt:s.customPrompt})),setAlbumLimit:s=>e({albumLimit:s,isGenerating:!1}),setGeneratedTracks:s=>e({generatedTracks:s}),setIsGenerating:s=>e({isGenerating:s}),setPlaylistName:s=>e({playlistName:s}),setExplanation:s=>e({explanation:s}),reset:()=>e({genre:null,subgenre:null,artistName:null,artistId:null,customPrompt:"",submittedPrompt:null,playlistName:null,explanation:null,generatedTracks:null,isGenerating:!1})}));function Q(){return L({queryKey:["artists"],queryFn:async()=>{const{data:e}=await A.get("/web/artists/");return e.artists}})}function D(e){return L({queryKey:["recommendedTracks",e],queryFn:async()=>{const{data:n}=await A.get(`/app/get_recommended_tracks/?artist_id=${e}`);return n.tracks},enabled:!!e})}function V(e){return L({queryKey:["customPrompt",e],queryFn:async()=>{const{data:n}=await A.get(`/app/create_playlist_from_user_prompt/?user_request=${encodeURIComponent(e)}`);return n},enabled:!!e})}function W({artists:e,value:n,onChange:s}){const[c,l]=i.useState(n??""),[u,g]=i.useState(!1),x=i.useRef(null);i.useEffect(()=>{l(n??"")},[n]),i.useEffect(()=>{function a(h){x.current&&!x.current.contains(h.target)&&g(!1)}return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const p=i.useMemo(()=>{if(!c.trim())return e.slice(0,50);const a=c.toLowerCase();return e.filter(h=>h.toLowerCase().split(/\s+/).some(y=>y.startsWith(a))).slice(0,50)},[e,c]);return t.jsxs("div",{ref:x,className:"relative",children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-300",children:"Artist"}),t.jsx("input",{type:"text",value:c,placeholder:"Type to search artists...",onChange:a=>{l(a.target.value),g(!0),a.target.value||s(null)},onFocus:()=>g(!0),className:"w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-base text-gray-200 sm:text-sm outline-none focus:border-indigo-500"}),u&&p.length>0&&t.jsx("ul",{className:"absolute z-50 mt-1 max-h-60 w-full overflow-y-auto rounded-lg border border-gray-700 bg-gray-800 py-1 shadow-lg",children:p.map(a=>t.jsx("li",{children:t.jsx("button",{type:"button",onClick:()=>{l(a),s(a),g(!1)},className:`w-full px-3 py-2 text-left text-base hover:bg-gray-700 sm:py-1.5 sm:text-sm ${a===n?"text-indigo-400":"text-gray-200"}`,children:a})},a))})]})}function J(){const e=K(),n=C(r=>r.isAuthorized),s=C(r=>r.createPlaylist),c=f(r=>r.playTracks),{data:l}=R(),{data:u}=Q(),g=i.useMemo(()=>l?G(Object.keys(l)):[],[l]),x=i.useMemo(()=>!l||!e.genre||!l[e.genre]?[]:["All",...l[e.genre].sort()],[l,e.genre]),p=i.useMemo(()=>u?G(Object.keys(u)):[],[u]),a=e.mode==="genre"&&e.genre?[e.genre]:void 0,h=e.mode==="genre"&&e.subgenre&&e.subgenre!=="All"?[e.subgenre]:void 0,{data:y}=$({minYear:e.minYear,maxYear:e.maxYear,genre:a,subgenre:h,enabled:e.mode==="genre"&&e.isGenerating&&!!e.genre}),v=i.useMemo(()=>y?y.map(r=>r.album_key):[],[y]),{data:b,isLoading:j}=E(v,e.albumLimit,e.mode==="genre"&&e.isGenerating&&v.length>0),{data:N,isLoading:o}=D(e.mode==="artist"&&e.isGenerating?e.artistId:null),{data:d,isLoading:T}=V(e.mode==="prompt"&&e.isGenerating?e.submittedPrompt:null),m=i.useMemo(()=>{if(e.mode==="genre")return b;if(e.mode==="artist")return N;if(e.mode==="prompt")return d==null?void 0:d.tracks},[e.mode,b,N,d]),w=e.mode==="genre"&&j||e.mode==="artist"&&o||e.mode==="prompt"&&T,M=i.useCallback(()=>{e.mode==="prompt"&&e.submitPrompt(),e.setIsGenerating(!0)},[e]),Y=i.useMemo(()=>e.mode==="genre"?!!e.genre:e.mode==="artist"?!!e.artistId:e.mode==="prompt"?e.customPrompt.trim().length>0:!1,[e.mode,e.genre,e.artistId,e.customPrompt]),P=i.useMemo(()=>e.mode==="genre"?e.subgenre??e.genre??"Genre":e.mode==="artist"?e.artistName??"Artist":e.mode==="prompt"?"Custom":"",[e]);async function S(){if(!m)return;const r=m.map(I=>I.track_id),k=await s(P,r);alert(k?"Playlist created! Check your Apple Music library.":"Failed to create playlist. Please try again.")}return t.jsxs("div",{className:"flex h-full flex-col overflow-y-auto",children:[t.jsxs(q,{label:"Radio Settings",children:[t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-300",children:"Radio Type"}),t.jsxs("select",{value:e.mode,onChange:r=>{e.setMode(r.target.value),e.setIsGenerating(!1)},className:"w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-base text-gray-200 sm:text-sm",children:[t.jsx("option",{value:"genre",children:"Genre"}),t.jsx("option",{value:"artist",children:"Artist"}),t.jsx("option",{value:"prompt",children:"Custom Prompt"})]})]}),e.mode==="genre"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-300",children:"Genre"}),t.jsxs("select",{value:e.genre??"",onChange:r=>e.setGenre(r.target.value||null),className:"w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-base text-gray-200 sm:text-sm",children:[t.jsx("option",{value:"",children:"Select a genre"}),g.map(r=>t.jsx("option",{value:r,children:r},r))]})]}),e.genre&&x.length>0&&t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-300",children:"Subgenre"}),t.jsx("select",{value:e.subgenre??"All",onChange:r=>e.setSubgenre(r.target.value==="All"?null:r.target.value),className:"w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-base text-gray-200 sm:text-sm",children:x.map(r=>t.jsx("option",{value:r,children:r},r))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(_,{label:"First Year",value:e.minYear,onChange:e.setMinYear}),t.jsx(_,{label:"Last Year",value:e.maxYear,onChange:e.setMaxYear,reverse:!0})]})]}),e.mode==="artist"&&t.jsx(W,{artists:p,value:e.artistName,onChange:r=>{e.setArtistName(r),e.setArtistId(r&&u?u[r]:null),e.setIsGenerating(!1)}}),e.mode==="prompt"&&t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-300",children:"Custom Prompt"}),t.jsx("textarea",{value:e.customPrompt,onChange:r=>e.setCustomPrompt(r.target.value),placeholder:"Describe the playlist you want...",rows:2,className:"w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-base text-gray-200 sm:text-sm outline-none focus:border-indigo-500"})]}),Y&&t.jsx("div",{className:"flex items-end",children:t.jsx("button",{type:"button",onClick:M,disabled:w,className:"w-full rounded-lg bg-indigo-600 px-3 py-2 text-sm font-medium text-white hover:bg-indigo-500 disabled:opacity-50",children:w?"Generating...":`Generate ${P} Radio`})}),n&&m&&m.length>0&&t.jsx("div",{className:"flex items-end",children:t.jsx("button",{type:"button",onClick:S,className:"w-full rounded-lg bg-pink-600 px-3 py-2 text-sm font-medium text-white hover:bg-pink-500",children:"Export to Apple Music"})})]}),t.jsxs("div",{className:"flex-1 p-4 sm:p-6",children:[!e.isGenerating&&t.jsx("p",{className:"py-10 text-center text-gray-500",children:"Pick a Genre, Artist, or Custom Prompt to start your radio."}),w&&t.jsx(F,{}),e.mode==="prompt"&&(d==null?void 0:d.explanation)&&t.jsxs("div",{className:"mb-6 rounded-lg border border-gray-700 bg-gray-900 p-4",children:[d.playlist_name&&t.jsx("h3",{className:"mb-2 text-lg font-semibold text-white",children:d.playlist_name}),t.jsx("p",{className:"text-sm text-gray-300",children:d.explanation})]}),m&&m.length>0&&t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("h2",{className:"text-xl font-bold text-white",children:["Recommended Tracks (",m.length,")"]}),n&&t.jsxs("button",{type:"button",onClick:()=>c(m,`${P} Radio`),className:"flex items-center gap-1.5 rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500",children:[t.jsx("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M8 5v14l11-7z"})}),"Play All"]})]}),m.map((r,k)=>t.jsx(O,{track:r,allTracks:m,trackIndex:k},r.track_id+k))]})]})]})}export{J as default};
